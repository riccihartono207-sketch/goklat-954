<!DOCTYPE html>
<html lang="id" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Goklat 945 - Order Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap");

      * {
        font-family: "Poppins", sans-serif;
        box-sizing: border-box;
      }

      /* Animasi Floating */
      .floating {
        animation: floating 3s ease-in-out infinite;
      }
      @keyframes floating {
        0% { transform: translate(0, 0px); }
        50% { transform: translate(0, 15px); }
        100% { transform: translate(0, -0px); }
      }

      /* Background Pattern saat Tutup */
      .bg-pattern {
        background-color: #f3e8ff;
        background-image: radial-gradient(#d8b4fe 1px, transparent 1px);
        background-size: 20px 20px;
      }

      .product-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .product-card:hover:not(.disabled) {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .whatsapp-btn {
        background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
        transition: all 0.3s ease;
      }

      .category-content {
        max-height: 0;
        opacity: 0;
        overflow: hidden;
        transition: max-height 0.4s ease, opacity 0.3s ease;
      }

      .category-content.open {
        max-height: 5000px;
        opacity: 1;
        padding-top: 1rem !important;
        padding-bottom: 1rem !important;
      }

      .rotate-icon {
        transition: transform 0.3s ease;
      }
      .rotate-icon.open {
        transform: rotate(180deg);
      }

      /* Modal Animation */
      .modal-enter {
        animation: modalScale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      @keyframes modalScale {
        from { opacity: 0; transform: scale(0.8) translateY(20px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
      }
    </style>
  </head>
  <body class="h-full w-full overflow-auto bg-gray-50" id="body-main">
    
    <!-- Pop-up Modal -->
    <div id="reload-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity duration-300">
      <div class="bg-white w-full max-w-sm rounded-[2.5rem] overflow-hidden shadow-2xl modal-enter border-4 border-purple-100">
        <div class="p-8 text-center">
          <div class="text-6xl mb-4 floating">üîÑ</div>
          <h2 class="text-2xl font-extrabold text-purple-900 mb-2 italic">Cek Stok Baru?</h2>
          <div class="bg-purple-50 p-4 rounded-2xl mb-6 border-2 border-dashed border-purple-200">
            <p class="text-purple-800 font-medium">
              "Yuk Reload sekali aja, siapa tau ada stok baru!!"
            </p>
          </div>
          <div class="flex flex-col gap-3">
            <button onclick="location.reload()" class="w-full py-4 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-2xl shadow-lg shadow-purple-200 transition-all active:scale-95">
              üîÑ Reload Halaman
            </button>
            <button onclick="closeModal()" class="w-full py-3 text-gray-400 hover:text-gray-600 font-semibold transition-colors">
              Nanti Saja (Close)
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="app" class="w-full min-h-full">
      <!-- Loading State -->
      <div class="flex flex-col items-center justify-center h-screen">
        <div class="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mb-4"></div>
        <p class="text-purple-900 font-semibold">Memuat Menu Goklat...</p>
      </div>
    </div>

    <script>
      // ==================================================
      // PENGATURAN TUTUP MENDADAK
      // Ganti ke 'true' jika ingin menutup toko secara paksa.
      // Ganti ke 'false' untuk mengikuti jadwal normal. ===================================================
      const tutupMendadak = false; 

      const config = {
        store_title: "Goklat 945",
        store_address: "Batang Ayumi Julu, Padang Sidempuan Utara",
        whatsapp_number: "6282277647548",
        opening_hours_text: "Senin - Jumat | 09.00 - 17.00",
        op_days: [1, 2, 3, 4, 5],
        op_start: 9,
        op_end: 17,
      };

      const DATA_URL = "Products.json";

      const locationData = {
        "Padangsidimpuan Utara": { "Batang Ayumi Julu": 2000, "Batang Ayumi Jae": 2000, "Baringin": 3000 },
        "Padangsidimpuan Selatan": { "Aek Tampang": 5000, "Hanopan": 5000 }
        // ... (data lokasi lainnya bisa ditambahkan di sini)
      };

      let categories = {};
      let cart = [];
      let openCategories = {};
      let selectedKecamatan = "";
      let selectedKelurahan = "";
      let currentShippingFee = 0;

      function closeModal() {
        const modal = document.getElementById('reload-modal');
        modal.classList.add('opacity-0');
        setTimeout(() => modal.style.display = 'none', 300);
      }

      function isStoreOpen() {
        if (tutupMendadak) return false;
        const now = new Date();
        const day = now.getDay();
        const hour = now.getHours();
        return config.op_days.includes(day) && hour >= config.op_start && hour < config.op_end;
      }

      async function loadProducts() {
        if (!isStoreOpen()) {
          renderClosedState();
          return;
        }

        try {
          const response = await fetch(`${DATA_URL}?v=${new Date().getTime()}`);
          if (!response.ok) throw new Error("Gagal mengambil data");
          categories = await response.json();
          renderApp();
        } catch (error) {
          document.getElementById("app").innerHTML = `<div class="p-10 text-center text-red-500 font-bold">${error.message}</div>`;
        }
      }

      function renderClosedState() {
        // Sembunyikan pop-up reload saat toko tutup agar tidak mengganggu pengumuman
        document.getElementById('reload-modal').style.display = 'none';
        document.getElementById('body-main').className = "bg-pattern h-full flex items-center justify-center p-6";
        
        document.getElementById("app").innerHTML = `
          <div class="max-w-md w-full bg-white rounded-[3rem] shadow-2xl overflow-hidden border-4 border-purple-200">
            <div class="p-8 text-center">
              <div class="relative py-10 flex justify-center">
                <div class="floating text-9xl">ü•§</div>
                <div class="absolute top-10 right-10 text-5xl">üí§</div>
                <div class="absolute bottom-10 left-10 text-4xl transform -rotate-12">üç´</div>
              </div>
              <div class="space-y-4">
                <h1 class="text-3xl font-extrabold text-purple-900 uppercase">PENGUMUMAN</h1>
                <div class="bg-purple-50 rounded-2xl p-6 border-2 border-dashed border-purple-300">
                  <p class="text-lg text-purple-800 font-semibold italic">
                    "Maaf hari ini Tokoh Goklat 945 tutup di Jadwal buka, terimakasih atas kunjungannya"
                  </p>
                </div>
                <p class="text-gray-500 text-sm">Sampai jumpa di hari berikutnya!</p>
              </div>
            </div>
            <div class="bg-purple-900 py-4 text-center">
              <p class="text-white text-xs font-bold tracking-widest uppercase">${config.store_title}</p>
            </div>
          </div>
        `;
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat("id-ID", { style: "currency", currency: "IDR", minimumFractionDigits: 0 }).format(amount);
      }

      function toggleCategory(key) {
        openCategories[key] = !openCategories[key];
        renderApp();
      }

      function addToCart(pid) {
        let product;
        for (let k in categories) {
          product = categories[k].products.find(p => p.id === pid);
          if (product) break;
        }
        if (!product || product.outOfStock) return;
        const item = cart.find(i => i.id === pid);
        if (item) item.qty++; else cart.push({...product, qty: 1});
        renderApp();
      }

      function updateQty(pid, delta) {
        const item = cart.find(i => i.id === pid);
        if (item) {
          item.qty += delta;
          if (item.qty <= 0) cart = cart.filter(i => i.id !== pid);
        }
        renderApp();
      }

      function renderApp() {
        const subtotal = cart.reduce((s, i) => s + (i.price * i.qty), 0);
        const total = subtotal + currentShippingFee;

        document.getElementById("app").innerHTML = `
          <div class="max-w-2xl mx-auto px-4 py-8">
            <header class="text-center mb-8">
               <div class="inline-block bg-purple-100 text-purple-700 px-4 py-1 rounded-full text-[10px] font-bold mb-4 uppercase tracking-widest">
                üïí ${config.opening_hours_text}
              </div>
              <h1 class="text-4xl font-extrabold text-purple-950 mb-1">${config.store_title}</h1>
              <p class="text-gray-500 text-xs">${config.store_address}</p>
            </header>

            <div class="space-y-4">
              ${Object.keys(categories).map(key => {
                const cat = categories[key];
                const isOpen = openCategories[key];
                return `
                  <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden transition-all">
                    <div onclick="toggleCategory('${key}')" class="p-5 flex justify-between items-center cursor-pointer bg-white active:bg-gray-50 transition-colors">
                      <div class="flex items-center gap-4">
                        <span class="text-3xl">${cat.icon || "ü•§"}</span>
                        <h2 class="text-lg font-bold text-gray-800">${cat.name}</h2>
                      </div>
                      <svg class="rotate-icon ${isOpen ? 'open' : ''}" width="20" height="20" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </div>
                    <div class="category-content ${isOpen ? 'open' : ''} grid grid-cols-2 gap-3 px-4">
                      ${cat.products.map(p => {
                        const inCart = cart.find(i => i.id === p.id);
                        return `
                          <div class="product-card bg-gray-50 rounded-2xl p-3 border border-transparent hover:border-purple-200">
                            <div class="aspect-square rounded-xl overflow-hidden mb-3 bg-white flex items-center justify-center p-2">
                              <img src="${p.image}" class="max-h-full max-w-full object-contain" alt="${p.name}">
                            </div>
                            <h3 class="text-[11px] font-bold text-gray-700 h-8 line-clamp-2 uppercase leading-tight mb-1">${p.name}</h3>
                            <p class="text-purple-700 font-extrabold text-sm mb-3">${formatCurrency(p.price)}</p>
                            ${inCart ? `
                              <div class="flex items-center justify-between bg-purple-600 text-white rounded-xl p-1 shadow-md">
                                <button onclick="updateQty(${p.id}, -1)" class="w-8 h-8 font-black">-</button>
                                <span class="font-bold">${inCart.qty}</span>
                                <button onclick="updateQty(${p.id}, 1)" class="w-8 h-8 font-black">+</button>
                              </div>
                            ` : `
                              <button onclick="addToCart(${p.id})" class="w-full py-2.5 bg-white border-2 border-purple-600 text-purple-600 font-bold rounded-xl text-xs hover:bg-purple-600 hover:text-white transition-all active:scale-95">Tambah</button>
                            `}
                          </div>
                        `;
                      }).join('')}
                    </div>
                  </div>
                `;
              }).join('')}
            </div>

            ${cart.length > 0 ? `
              <div class="mt-8 bg-white p-6 rounded-[2.5rem] shadow-xl border border-purple-100">
                <h3 class="text-xl font-bold text-purple-900 mb-6 flex items-center gap-2">üõí <span>Ringkasan Order</span></h3>
                <div class="space-y-4 mb-6">
                  ${cart.map(i => `
                    <div class="flex justify-between items-center text-sm border-b border-gray-50 pb-2">
                      <div class="text-gray-700 font-medium">${i.name} <span class="text-purple-400 font-bold">x${i.qty}</span></div>
                      <div class="font-bold text-gray-900">${formatCurrency(i.price * i.qty)}</div>
                    </div>
                  `).join('')}
                </div>
                <div class="bg-purple-950 p-6 rounded-3xl text-white">
                  <div class="flex justify-between font-bold text-lg italic">
                    <span>Total Tagihan</span>
                    <span class="text-yellow-400">${formatCurrency(subtotal)}</span>
                  </div>
                </div>
                <button onclick="window.open('https://wa.me/${config.whatsapp_number}?text=' + encodeURIComponent('Halo Goklat! Saya ingin pesan...'), '_blank')" 
                  class="whatsapp-btn w-full mt-4 py-4 text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2">
                  <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
                  Order Via WhatsApp
                </button>
              </div>
            ` : ''}
            
            <footer class="mt-12 text-center text-gray-300 text-[10px] tracking-widest uppercase font-bold italic">
              &copy; 2026 Goklat 945 - Padang Sidempuan
            </footer>
          </div>
        `;
      }

      window.onload = loadProducts;
    </script>
  </body>
</html>